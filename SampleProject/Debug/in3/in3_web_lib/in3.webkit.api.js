var g_DEFAULT_WEB_LOAD=true;var g_n_total_page=0;var g_n_col_gap_width=0;var g_n_before_width_colNgap=0;var g_f_before_page_rate=0;var g_n_col_count=2;var g_n_col_width=0;var CONFIG=(function(){var c={VER:"0.1",ANOTHER_CONST:"2"};return{get:function(d){return c[d]}}})();function IncubeMarkers(){var c={ANNOTATION:0,BOOKMARK:0};var e={ANNOTATION:"incube_marker_annotation_",BOOKMARK:"incube_marker_bookmark_"};var d={ANNOTATION:"IN3_cls_annotation",BOOKMARK:"IN3_cls_bookmark",MEMO_ICON:"IN3_cls_memoicon"};this.getMarkerClass=function(f){return d[f]};this.getNextMarkerName=function(h){var l=e[h];for(var g=c[h];true;g++){var f=l+g;var n=jQuery("a[name="+f+"]");var k=jQuery("div[id="+f+"]");if(n.length==0&&k.length==0){c[h]=g+1;return f}}return null}}var g_marker_manager=new IncubeMarkers();var CALLBACK_HEADER="#SEND_ENGINE#";var CALL_APP_HEADER="#RECV_APP#";function _makeError(c,d){return{RESULT_CODE:c,ERROR_MSG:d}}function _makeResponse(){return{RESULT_CODE:0}}function trim(c){return c.replace(/^\s+|\s+$/g,"")}function ltrim(c){return c.replace(/^\s+/,"")}function rtrim(c){return c.replace(/\s+$/,"")}function procCmd(d,f,e){var g="";var c=f;if(f=="IN3_CMD_PAGE_INIT"){c="IN3_CMD_COMPLETE_FILE_INIT";g=procInitPage(e);_debug("PAGING:Script.procInitPage param: "+e+", ret:"+JSON.stringify(g))}else{if(f=="IN3_CMD_GET_DOCUMENT_SIZE_FOR_CAPTURE"){g=procGetDocSize()}else{if(f=="IN3_CMD_GET_COUNT_PAGE_TOTAL"){g=procCountTotalPage()}else{if(f=="IN3_CMD_ACTION_PAGE_MOVE"){g=procMovePage(e);_debug("PAGING:Script.procMovePage param: "+e+", ret:"+g)}else{if(f=="IN3_CMD_ACTION_PAGE_MOVE_FOR_CAPTURE"){g=procMovePage(e)}else{if(f=="IN3_CMD_ACTION_CHANGE_COLORS"){g=procChangeColors(e)}else{if(f=="IN3_CMD_ACTION_CHANGE_FONT_SIZE"){g=procChangeFontSize(e)}else{if(f=="IN3_CMD_ACTION_CHANGE_FONT_SIZE_AND_REPAGING"){g=procChangeFontSizeAndRepaging(e);c="IN3_CMD_COMPLETE_FILE_INIT"}else{if(f=="IN3_CMD_ACTION_MOVE_TO_OBJECT_ID"){g=procMoveToObjectIDorName(e);c="IN3_CMD_ACTION_PAGE_MOVE"}else{if(f=="IN3_CMD_ACTION_MOVE_TO_SEARCH_RESULT"){g=procMoveToSearchResult(e);c="IN3_CMD_ACTION_PAGE_MOVE"}else{if(f=="IN3_CMD_ACTION_MARK_ANNOTATION"){g=procMarkAnnotation(e)}else{if(f=="IN3_CMD_ACTION_DELETE_ANNOTATION"){g=procDeleteAnnotation(e)}else{if(f=="IN3_CMD_ACTION_MODIFY_ANNOTATION"){g=procModifyAnnotation(e)}else{if(f=="IN3_CMD_ACTION_INIT_ANNOTATION_LIST"){g=procInitAnnotationList(e)}else{if(f=="IN3_CMD_ACTION_QUERY_SELECTION_POSITION"){g=procQuerySelectionPosition(e)}else{if(f=="IN3_CMD_ACTION_SET_BOOKMARK"){g=procSetBookmarkToCurrentPage(e)}else{if(f=="IN3_CMD_ACTION_CLEAR_BOOKMARK"){g=procClearBookmarksOnCurrentPage(e)}else{if(f=="IN3_CMD_ACTION_DELETE_BOOKMARKS"){g=procDeleteBookmarksById(e)}else{if(f=="IN3_CMD_ACTION_QUERY_BOOKMARK_STATUS"){g=procQueryBookmarksStatusOnCurrentPage(e);c="IN3_CMD_EVENT_BOOKMARK_STATUS"}else{if(f=="IN3_CMD_ACTION_INIT_BOOKMARK_LIST"){g=procInitBookmarkList(e)}else{if(f=="IN3_CMD_ACTION_FIND_TEXT_ALL"){g=procFindTextAll(e)}else{if(f=="IN3_CMD_ACTION_FIND_TEXT"){g=procFindText(e)}}}}}}}}}}}}}}}}}}}}}}if(ANDROID||WEB_TEST){if(f=="IN3_CMD_ACTION_START_SELECTION"){g=procStartSelection(e);if(g==null){return}c="IN3_CMD_ACTION_SET_SELECTION"}else{if(f=="IN3_CMD_ACTION_SET_SELECTION"){g=procSetSelection(e);if(g==null){return}}}}if(f=="IN3_CMD_ACTION_CANCEL_SELECTION"){g=procCancelSelection()}if(KERIS){if(f=="IN3_CMD_OPEN_POPUP_WEB"){g=e}}CALLBACK_APP(d,c,g)}function CALLBACK_APP(d,e,g){var f={SOURCE:CALLBACK_HEADER,CMD_TYPE:d,CMD_CODE:e,PARAM:g};var c=JSON.stringify(f);if(IOS||PC){window.location="appcall?"+c}else{if(ANDROID){IN3JSBridge.IN3_JavascriptCallback(c)}else{parent.callback(c)}}}function procInitPage(f){var l=JSON.parse(f);var s=l.FONT_SIZE;var p=l.FONT_FAMILY;var c=l.FOREGROUND_COLOR;var q=l.BACKGROUND_COLOR;g_n_col_gap_width=parseInt(l.COLUMN_GAP);g_n_col_count=parseInt(l.COLUMN_COUNT);var k=l.KEEP_CURRENT_PAGE;var o=document.body;var e=o.scrollLeft/o.scrollWidth;var g=jQuery(window).height();var d=jQuery(window).width();if(g_n_col_count==1){g_n_col_width=d}else{g_n_col_width=Math.floor((d+g_n_col_gap_width)/g_n_col_count)-g_n_col_gap_width}if(PC){jQuery("body").height(g)}else{jQuery("body").css("height",g+"px !important;")}jQuery("body").css("margin","0px !important;");jQuery("body").css("padding","0px !important;");jQuery("body").css("border","0px solid #dedede !important;");jQuery("body").css("-webkit-column-rule",g_n_col_gap_width+"px solid #dddddd !important;");jQuery("body").css("-webkit-column-gap",g_n_col_gap_width+"px !important;");jQuery("body").css("-webkit-column-width",g_n_col_width+"px !important;");jQuery("body").css("-webkit-column-width",d/g_n_col_count-g_n_col_gap_width*2);if(s!="0pt"){jQuery("body").css("font-size",s)}if(p!=""){jQuery("body").css("font-family",p)}if(c!=""){jQuery("body").css("color",c)}if(q!=""){jQuery("body").css("background-color",q)}var r=getFilePageCount(true);var n=1;if(k!=null&&k==true){n=Math.ceil(r*e)+1;n=moveToPage(n)}var h=_makeResponse();h.FILE_NAME=jQuery(location).attr("href");h.FILE_PAGE_COUNT=r;h.FILE_PAGE_WIDTH=g_n_col_width;h.CURRENT_PAGE=n;return h}function procMovePage(e){var c=moveToPage(e);if(c==-1){return _makeError(1,"page number format error["+e+"]")}if(c==-2){return _makeError(2,"page number is out of bound["+e+"]")}var d=_makeResponse();d.CURRENT_PAGE=c;return d}function moveToPage(e){if(isNaN(e)){return -1}var d=parseInt(e);var c=getFilePageCount(false);if(d<1||d>c){return -2}var g=Math.floor((d-1)/g_n_col_count)*g_n_col_count;var f=(g_n_col_width+g_n_col_gap_width)*g;jQuery(document).scrollLeft(f);g_f_before_page_rate=(g+1)/getFilePageCount(false);return g+1}function procMoveToObjectIDorName(e){var c=moveToObjectIDorName(e);var d=_makeResponse();d.CURRENT_PAGE=c;return d}function procMoveToSearchResult(g){var f=JSON.parse(g);var c=f.KEYWORD;var h=f.SEQUENCE;var d=window.getSelection();d.removeAllRanges();for(i=0;i<h;i++){matches=window.find(c,false,false,false,false,false,false)}_fitScroll();var e=_makeResponse();e.CURRENT_PAGE=getCurrentPage();return e}function moveToObjectIDorName(g){var k="#"+g;var f=jQuery(k);if(f==null||f.length==0){var e=jQuery("*[name="+g+"]");if(e==null||e.length==0){return getCurrentPage()}f=jQuery(e[0])}var d=f.offset();var c=d.left;var h=Math.floor(c/(g_n_col_width+g_n_col_gap_width))+1;return moveToPage(h)}function procChangeColors(g){var f=JSON.parse(g);var e=f.FOREGROUND_COLOR;var d=f.BACKGROUND_COLOR;if(e!=""){jQuery("body").css("color",e)}if(d!=""){jQuery("body").css("background-color",d)}var c=_makeResponse();return c}function procChangeFontSize(e){jQuery("body").css("font-size",e);var c=movePageAfterChangeFontSize();if(c==-1){return _makeError(1,"page number format error["+pageNum+"]")}else{if(c==-2){return _makeError(2,"page number is out of bound["+nPageNum+"]")}}var d=_makeResponse();d.CURRENT_PAGE=c;return d}function movePageAfterChangeFontSize(){var c=g_f_before_page_rate;var g=jQuery(window).width()+parseInt(jQuery("body").css("-webkit-column-gap"));var d=jQuery(document).width();var f=d*c;g_n_before_width_colNgap=g;var e=Math.floor(f/g)+1;return moveToPage(e)}function procChangeFontSizeAndRepaging(e){jQuery("body").css("font-size",e);var c=getFilePageCount(true);var d=_makeResponse();d.FILE_PAGE_COUNT=c;return d}function checkMovePage(c){if(jQuery(document).scrollLeft()!=c){setTimeout(checkMovePage,100,c)}}function showDocument(){jQuery("body").css("display","block")}function procGetDocSize(){var c=jQuery(document).height();var d=jQuery(document).width();var e=_makeResponse();e.WIDTH=d;e.HEIGHT=c;return e}function procCountTotalPage(){var c=getFilePageCount(true);var d=_makeResponse();d.FILE_PAGE_COUNT=c;return d}function getFilePageCount(c){if(c==false&&g_n_total_page!=0){return g_n_total_page}var d=jQuery(document).width();g_n_total_page=Math.floor((d+g_n_col_gap_width)/(g_n_col_width+g_n_col_gap_width));_debug("getFilePageCount = (DocWidth + ColGap) / (ColWidth + ColGap) : ("+d+" + "+g_n_col_gap_width+") / ("+g_n_col_width+" + "+g_n_col_gap_width+") = "+g_n_total_page);_debug("getFilePageCount = DocH:"+jQuery(document).height()+", bodyW:"+jQuery("body").width());return g_n_total_page}function getCurrentPage(){var c=jQuery(document).scrollLeft();var d=Math.floor(c/(g_n_col_width+g_n_col_gap_width))+1;return d}function _createMemoIcon(l){var d=document.createElement("img");var o=g_marker_manager.getMarkerClass("MEMO_ICON");var f=jQuery(window).width();var h=document.getElementsByName(l);var c=h[0];var n=_getBoxOfNodeList(h);var k=(n.left+(f-n.right))/2-n.left;var g=jQuery(document).scrollLeft();var p=k>0?g_in3_memo_left_icon_src:g_in3_memo_right_icon_src;var e=k>0?4:(f-40);e+=g;jQuery(d).attr("id","icon."+l);jQuery(d).attr("name",l);jQuery(d).attr("src",p);jQuery(d).addClass(o);jQuery(d).css("position","absolute");jQuery(d).css("left",e+"px");jQuery(d).css("top",n.top+"px");d.onclick=function(){callbackOnMemoIconSelected(this.name);return true};jQuery("body").append(d)}function procMarkAnnotation(d){var l=JSON.parse(d);var q=l.BG_COLOR;var e=l.HAS_MEMO;var r=window.getSelection();if(r==null||r.type=="Caret"||r.type=="None"){return _makeError(1,"Select text first")}var o=r.getRangeAt(0);var f=_getRangeIndex(o);var c=g_marker_manager.getNextMarkerName("ANNOTATION");var p=g_marker_manager.getMarkerClass("ANNOTATION");var n=createMarker(c,p);if(n==null||n.length==0){return _makeError(1,"cannot create new marker")}for(var k=0;k<n.length;k++){var h=n[k];_setAnnotation(h,q,e)}if(e){_createMemoIcon(c)}var g=_makeResponse();g.FILE_NAME=jQuery(location).attr("href");g.START_INDEX=f.start_index;g.END_INDEX=f.end_index;g.MARKER_ID=c;g.SELECTION_TEXT=_getAnnotationText(n);g.BG_COLOR=q;g.HAS_MEMO=e;return g}function procDeleteAnnotation(d){var g=JSON.parse(d);var h=g.MARKER_ID;var k=jQuery("a[name="+h+"]");var e=jQuery("img[name="+h+"]");if(k!=null&&k.length!=0){for(a=0;a<k.length;a++){var l=k[a];var c=jQuery(l).html();jQuery(l).replaceWith(c)}}if(e!=null&&e.length!=0){for(i=0;i<e.length;i++){var n=e[i];jQuery(n).remove()}}var f=_makeResponse();f.FILE_NAME=jQuery(location).attr("href");f.MARKER_ID=h;return f}function _setAnnotation(c,d,e){if(c==null){return}if(d==""){jQuery(c).css("text-decoration","underline");jQuery(c).css("background-color","transparent")}else{jQuery(c).css("text-decoration","none");jQuery(c).css("background-color",d)}if(e){c.onclick=function(){callbackOnAnnotationSelected(this.name,true);return true}}else{c.onclick=function(){callbackOnAnnotationSelected(this.name,false);return true}}}function procModifyAnnotation(c){var g=JSON.parse(c);var h=g.MARKER_ID;var o=g.BG_COLOR;var d=g.HAS_MEMO;var k=jQuery("a[name="+h+"]");var e=jQuery("img[name="+h+"]");if(k!=null&&k.length!=0){for(a=0;a<k.length;a++){var l=k[a];_setAnnotation(l,o,d)}}var n=false;if(e!=null&&e.length!=0){n=true}if(d!=n){if(d){_createMemoIcon(h)}else{for(i=0;i<e.length;i++){var p=e[i];jQuery(p).remove()}}}var f=_makeResponse();f.FILE_NAME=jQuery(location).attr("href");f.MARKER_ID=h;f.BG_COLOR=o;f.HAS_MEMO=d;return f}function procInitAnnotationList(d){var e="."+g_marker_manager.getMarkerClass("ANNOTATION");var u="."+g_marker_manager.getMarkerClass("MEMO_ICON");jQuery(e).replaceWith(function(){return jQuery(this).html()});jQuery(u).remove();var c=JSON.parse(d);var s=c.ANNOTATION_LIST;_debug("ANNOTATION:Script.procInitAnnotationList:PARAM="+d);for(a=0;a<s.length;a++){var f=s[a];var o=f.MARKER_ID;var r=f.START_INDEX;var n=f.END_INDEX;var q=f.BG_COLOR;var g=f.HAS_MEMO;_selectTextWithIndex(r,n);var p=g_marker_manager.getMarkerClass("ANNOTATION");var l=createMarker(o,p);if(l==null||l.length==0){continue}for(m=0;m<l.length;m++){var k=l[m];_setAnnotation(k,q,g)}if(g==true){_createMemoIcon(o)}}var h=_makeResponse();return h}function procQuerySelectionPosition(g){var e=_makeResponse();e.SHOW_HIDE=false;e.SELECTION_LEFT=0;e.SELECTION_TOP=0;e.SELECTION_RIGHT=0;e.SELECTION_BOTTOM=0;var d=window.getSelection();if(d==null||d.type=="Caret"||d.type=="None"){return e}else{var c=d.getRangeAt(0);var h=c.getClientRects();if(h==null||h.length==0){return e}var f=h[0];e.SHOW_HIDE=true;e.SELECTION_TEXT=c.toString();e.SELECTION_LEFT=f.left;e.SELECTION_TOP=f.top;e.SELECTION_RIGHT=f.right;e.SELECTION_BOTTOM=f.bottom}return e}function _getFirstVisibleElement(){var h=jQuery(document).scrollLeft();var d=jQuery(window).width();var c=jQuery(window).height();var g=jQuery("body *").filter(function(){var l=jQuery(this);if(l[0].childNodes.length==0||l.text().length==0){return false}var n=l.offset();var k=l.width();if(n.left>=h&&n.left<(h+d)){return true}return false});if(g.length>0){return g[0]}var f=jQuery("body *").filter(function(){var n=jQuery(this);if(n[0].childNodes.length==0||n.text().length==0){return false}var o=n.offset();var l=n.width();var k=n.height();if(o.top+k>c){l=(g_n_col_width+g_n_col_gap_width)*Math.ceil(k/c)-g_n_col_gap_width}if((o.left+l)>=h&&(o.left+l)<=(h+d)){return true}return false});if(f.length>0){return f[f.length-1]}var e=jQuery("body *").filter(function(){var n=jQuery(this);if(n[0].childNodes.length==0||n.text().length==0){return false}var o=n.offset();var l=n.width();var k=n.height();if(o.top+k>c){l=(g_n_col_width+g_n_col_gap_width)*Math.ceil(k/c)-g_n_col_gap_width}if(o.left<h&&(o.left+l)>(h+d)){return true}return false});if(e.length>0){return e[0]}return document.body}function _getFirstVisibleRange(c){var d=jQuery(window).width();var f=jQuery(window).height();var h=jQuery(c).contents().filter(function(){var s=jQuery(this);if(s[0].nodeType==Node.TEXT_NODE&&trim(s.text())!=""){return true}return false});var e=null;for(t=0;t<h.length;t++){var g=document.createRange();g.selectNode(h[t]);var r=trim(jQuery(h[t]).text());var k=g.getClientRects();for(i=0;i<k.length;i++){var l=k[i];if(l.left>=0&&l.left<=d){e=h[t];break}}if(e!=null){break}}if(e==null){var n=document.createRange();n.setStart(c,0);n.setEnd(c,0);return n}else{var q=e.length;var p=document.createRange();var o=-1;for(j=0;j<q;j++){p.setStart(e,j);p.setEnd(e,j+1);var k=p.getClientRects();for(i=0;i<k.length;i++){var l=k[i];if(l.left>0&&l.left<=d){p.setStart(e,Math.min(j,q));p.setEnd(e,Math.min(j,q));return p}}}}return null}function procSetBookmarkToCurrentPage(c){var h=g_marker_manager.getNextMarkerName("BOOKMARK");var k=g_marker_manager.getMarkerClass("BOOKMARK");var d=_getFirstVisibleElement();if(d==null){return _makeError(1,"Fail to find first visible element")}var n=_getFirstVisibleRange(d);if(n==null){return _makeError(1,"Fail to find first visible range")}var l=document.createElement("div");jQuery(l).attr("id",h);jQuery(l).addClass(k);n.insertNode(l);var g=document.createRange();g.selectNode(l);var e=_getRangeIndex(g);var f=_makeResponse();f.FILE_NAME=jQuery(location).attr("href");f.MARKER_ID=h;f.MARKER_PAGE=getCurrentPage();f.MARKER_INDEX=e.start_index;return f}function procClearBookmarksOnCurrentPage(f){var d=_getBookmarksOnCurrentPage();var c=new Array();for(b=0;b<d.length;b++){c.push(d[b].id);jQuery(d[b]).remove()}var e=_makeResponse();e.FILE_NAME=jQuery(location).attr("href");e.MARKER_ID_LIST=c;return e}function procDeleteBookmarksById(f){var e=JSON.parse(f);var c=e.BOOKMARK_LIST;for(i=0;i<c.length;i++){jQuery("#"+c[i]).remove()}var d=_makeResponse();d.FILE_NAME=jQuery(location).attr("href");d.MARKER_ID_LIST=c;return d}function notifyBookmarkStatusOnCurrentPage(f){var d=_getBookmarksOnCurrentPage();var c=false;if(d!=null&&d.length>0){c=true}var e=_makeResponse();e.HAS_BOOKMARK=c;CALLBACK_APP("CMD_TYPE_VIEWER","IN3_CMD_EVENT_BOOKMARK_STATUS",e)}function _getBookmarksOnCurrentPage(){var c=jQuery(window).width();var e=jQuery(document).scrollLeft();var d=jQuery(".IN3_cls_bookmark").filter(function(){var k=jQuery(this);var g=jQuery(k[0].nextSibling);if(g[0].nodeType==Node.TEXT_NODE&&trim(g.text()).length!=0){var f=_getTextNodePosition(g[0]);if(0<=f.left&&f.left<=c){return true}return false}else{var h=k.offset();if(e<=h.left&&h.left<=(e+c)){return true}return false}});return d}function procQueryBookmarksStatusOnCurrentPage(f){var d=_getBookmarksOnCurrentPage();var c=false;if(d!=null&&d.length>0){c=true}var e=_makeResponse();e.HAS_BOOKMARK=c;return e}function procInitBookmarkList(d){var c=JSON.parse(d);var l="."+g_marker_manager.getMarkerClass("BOOKMARK");jQuery(l).remove();var e=c.BOOKMARK_LIST;for(a=0;a<e.length;a++){var n=e[a];var h=n.MARKER_ID;var o=n.MARKER_INDEX;var g=_getBookmarkRange(o);var k=_getRangeIndex(g);var p=g_marker_manager.getMarkerClass("BOOKMARK");var q=document.createElement("div");jQuery(q).attr("id",h);jQuery(q).addClass(p);g.insertNode(q)}var f=_makeResponse();return f}function procFindTextAll(h){var g=JSON.parse(h);var d=g.KEYWORD;var c=_findAll(d);var f=_makeResponse();var e=new Array();for(i=0;i<c.length;i++){e.push(c[i])}f.FILE_NAME=jQuery(location).attr("href");f.FIND_RESULT=e;return f}function procFindText(h,d){var g=JSON.parse(h);var c=g.KEYWORD;var d=g.FORWARD;var f=_findString(c,!d);var e=_makeResponse();e.MATCHES=f;e.CURRENT_PAGE=getCurrentPage();e.KEYWORD=c;e.FORWARD=d;return e}function procStartSelection(g){var f=JSON.parse(g);var c=f.POINT_X;var h=f.POINT_Y;var d=createSelectionUsingCaret(c,h);if(d==null){return null}var e=_makeResponse();e.BEGIN_POINT_X=d.begin_x;e.BEGIN_POINT_Y=d.begin_y;e.END_POINT_X=d.end_x;e.END_POINT_Y=d.end_y;return e}function procSetSelection(d){var f=JSON.parse(d);var h=f.BEGIN_POINT_X;var g=f.BEGIN_POINT_Y;var n=f.END_POINT_X;var k=f.END_POINT_Y;var l=f.debug_seq;var c=updateSelectionUsingCaret(h,g,n,k);if(c==null){return null}var e=_makeResponse();e.BEGIN_POINT_X=c.begin_x;e.BEGIN_POINT_Y=c.begin_y;e.END_POINT_X=c.end_x;e.END_POINT_Y=c.end_y;return e}function procCancelSelection(){window.getSelection().removeAllRanges();g_range_start=null;g_range_end=null;return _makeResponse()}function _getAnnotationText(d){if(d==null||d.length==0){return""}var c="";for(i=0;i<d.length;i++){c+=jQuery(d[i]).text()}return c}function _getAnnotationColor(e){if(e==null||e.length==0){return""}var d=e[0];var f=jQuery(d).css("background-color");var c=jQuery(d).css("text-decoration");if(c=="none"){return f}else{return""}}function callbackOnAnnotationSelected(c,g){var e=jQuery("a[name="+c+"]");if(e==null||e.length==0){return}var f=_getBoxOfRangeOrElement(e[0]);var d=_makeResponse();d.FILE_NAME=jQuery(location).attr("href");d.MARKER_ID=c;d.SELECTION_TEXT=_getAnnotationText(e);d.BG_COLOR=_getAnnotationColor(e);d.HAS_MEMO=g;d.SELECTION_LEFT=f.left;d.SELECTION_TOP=f.top;d.SELECTION_RIGHT=f.right;d.SELECTION_BOTTOM=f.bottom;CALLBACK_APP("CMD_TYPE_VIEWER","IN3_CMD_EVENT_ON_SELECT_ANNOTATION",d)}function callbackOnMemoIconSelected(c){var e=jQuery("a[name="+c+"]");if(e==null||e.length==0){return}var f=_getBoxOfNodeList(e);var d=_makeResponse();d.FILE_NAME=jQuery(location).attr("href");d.MARKER_ID=c;d.CONTENT_BOX_LEFT=f.left;d.CONTENT_BOX_TOP=f.top;d.CONTENT_BOX_RIGHT=f.right;d.CONTENT_BOX_BOTTOM=f.bottom;CALLBACK_APP("CMD_TYPE_VIEWER","IN3_CMD_EVENT_ON_SELECT_MEMO_ICON",d)}function getIntValue(c){return(typeof(c)=="number")?new Number(c):0}function getOnlyNumber(c){c=c.replace(" ","");c=c.replace("px","");return c}function IN3_openPopupWeb(f,g,d){var c={open_url:f,popup_width:g,popup_height:d};var e=JSON.stringify(c);procCmd("CMD_TYPE_VIEWER","IN3_CMD_OPEN_POPUP_WEB",e)}function _IN3ObjectEditableState(c,d){this.designMode=c;this.contentEditable=d}function beginEditingMode(){var c=new _IN3ObjectEditableState(document.designMode,document.body.contentEditable);document.designMode="on";document.body.contentEditable=true;return c}function restoreEditingMode(c){document.designMode=c.designMode;document.body.contentEditable=c.contentEditable}function execWebkitCommand(d,g){var f=beginEditingMode();try{var c=document.execCommand(d,false,g);if(!c){_debug("Fail: "+document.body.isContentEditable)}}catch(e){_debug(e)}restoreEditingMode(f)}function _fitScroll(){var c=jQuery(document).scrollLeft();var d=Math.floor(c/(g_n_col_width+g_n_col_gap_width));var e=(g_n_col_width+g_n_col_gap_width)*d;jQuery(document).scrollLeft(e)}function _findString(c,d){var e=window.find(c,false,d,false,false,false,false);if(e){_fitScroll()}return e}function _findAll(d){var o=window.getSelection();var e=null;if(o.rangeCount>0){e=o.getRangeAt(0)}var g=jQuery(document).scrollLeft();o.removeAllRanges();var p=1;var n=new Array();var f=true;while(f){f=window.find(d,false,false,false,false,false,false);if(f){var h=o.getRangeAt(0);var l=_getRangeIndex(h);h.expand("sentence");var k=h.toString();var c={SEQ:(p++),PAGE:_getPageNumberOfRangeOrElement(h),START_INDEX:l.start_index,END_INDEX:l.end_index,SENTENCE:k};n.push(c)}}o.removeAllRanges();jQuery(document).scrollLeft(g);if(e!=null){o.addRange(e)}return n}function createMarker(h,d){var c=beginEditingMode();var l=window.getSelection();_debug("Script.createMarker Selection type : "+l.type);if(l==null||l.type=="Caret"||l.type=="None"){restoreEditingMode(c);return null}var k="__incube_bookmark__"+Math.round(Math.random()*100);var n=document.execCommand("CreateLink",false,k);if(!n){_debug("Script.createMarker CreateLink failed");restoreEditingMode(c);return null}var g=jQuery("a[href="+k+"]");_debug("CreateLink a tag count: "+g.length);for(var f=0;f<g.length;f++){var e=g[f];e.removeAttribute("href");e.setAttribute("name",h);e.setAttribute("class",d)}restoreEditingMode(c);return g}function queryCreateMarker(){var c=document.queryCommandState("CreateLink");var f=new String(c);var d="CMD_TYPE_ENGINE";var e="IN3_CMD_GET_CREATEMARKER_STATE";CALLBACK_APP(d,e,f)}function _getRangeIndex(c){var d=document.createRange();d.setStart(document.body,0);d.setEnd(c.startContainer,c.startOffset);var f=d.toString().length;d.setStart(document.body,0);d.setEnd(c.endContainer,c.endOffset);var e=d.toString().length;return{start_index:f,end_index:e}}function _getBoxOfRangeOrElement(f){var g=f.getClientRects();var e={left:10000,top:10000,right:0,bottom:0};if(g==null||g.length==0){return{left:0,top:0,right:0,bottom:0}}for(i=0;i<g.length;i++){e.left=Math.min(e.left,g[i].left);e.top=Math.min(e.top,g[i].top);e.right=Math.max(e.right,g[i].right);e.bottom=Math.max(e.bottom,g[i].bottom)}var d=jQuery(window).height();var c=jQuery(window).width();e.left=Math.max(e.left,0);e.top=Math.max(e.top,0);e.right=Math.min(e.right,c);e.bottom=Math.min(e.bottom,d);return e}function _getPageNumberOfRangeOrElement(f){var c=_getBoxOfRangeOrElement(f);var e=jQuery(document).scrollLeft()+c.left;var d=Math.floor(e/(g_n_col_width+g_n_col_gap_width))+1;return d}function _getTextNodePosition(e){if(e==null||e.nodeType!=Node.TEXT_NODE){return{left:0,top:0}}var d=document.createRange();if(e.length==0){d.selectNode(e)}else{d.setStart(e,0);d.setEnd(e,1)}var c=d.getClientRects();if(c==null||c.length==0){return{left:0,top:0}}return{left:c[0].left,top:c[0].top}}function _getUnionBox(f,e){var d=jQuery(window).height();var c=jQuery(window).width();return{left:Math.max(0,Math.min(f.left,e.left)),top:Math.max(0,Math.min(f.top,e.top)),right:Math.min(c,Math.max(f.right,e.right)),bottom:Math.min(d,Math.max(f.bottom,e.bottom)),}}function _getBoxOfNodeList(c){if(c==null||c.length==0){return{left:0,top:0,right:0,bottom:0}}var d={left:10000,top:10000,right:0,bottom:0};for(i=0;i<c.length;i++){var e=_getBoxOfRangeOrElement(c[i]);d=_getUnionBox(d,e)}return d}function _selectTextWithIndex(e,d){var c=_getAnnotationRange(e,d);window.getSelection().removeAllRanges();window.getSelection().addRange(c)}function _getAnnotationRange(l,k){if(l<0){return null}if(k<0){return null}if(l>k){var c=l;l=k;k=c}var d=document.createRange();var h=document.createRange();d.setStart(document.body,0);var g=document.body;while(g!=null){d.setEndAfter(g);var f=d.toString().length;if(f>l){if(g.nodeName=="#text"){d.setEnd(g,0);var e=d.toString().length;h.setStart(g,l-e);_debug("START: "+g+", "+(l-e));break}else{g=g.firstChild}}else{g=g.nextSibling}}g=document.body;while(g!=null){d.setEndAfter(g);var f=d.toString().length;if(f>=k){if(g.nodeName=="#text"){d.setEnd(g,0);var e=d.toString().length;h.setEnd(g,k-e);_debug("END: "+g+", "+(k-e));break}else{g=g.firstChild}}else{g=g.nextSibling}}return h}function _getBookmarkRange(c){if(c<0){return null}var d=document.createRange();var h=document.createRange();d.setStart(document.body,0);var g=document.body;while(g!=null){d.setEndAfter(g);var f=d.toString().length;if(f>c){if(g.nodeName=="#text"){d.setEnd(g,0);var e=d.toString().length;h.setStart(g,c-e);h.setEnd(g,c-e);_debug("START: "+g+", "+(c-e));break}else{g=g.firstChild}}else{g=g.nextSibling}}return h}function onMediaOverlayTextStarted(f){var e=document.getElementsByName(f);for(var d=0;d<e.length;d++){var c=e[d];c.classList.add("in3_mediaoverlay_text_selection")}var g=document.getElementById(f);if(g!=null){g.classList.add("in3_mediaoverlay_text_selection")}_debug("onMediaOverlayTextStarted("+f+")")}function onMediaOverlayTextFinished(f){var e=document.getElementsByName(f);for(var d=0;d<e.length;d++){var c=e[d];c.classList.remove("in3_mediaoverlay_text_selection")}var g=document.getElementById(f);if(g!=null){g.classList.remove("in3_mediaoverlay_text_selection")}_debug("onMediaOverlayTextFinished("+f+")")}function onMediaOverlaySectionStarted(f){var e=document.getElementsByName(f);for(var d=0;d<e.length;d++){var c=e[d];c.classList.add("in3_mediaoverlay_section_selection")}var g=document.getElementById(f);if(g!=null){g.classList.add("in3_mediaoverlay_section_selection")}}function onMediaOverlaySectionFinished(f){var e=document.getElementsByName(f);for(var d=0;d<e.length;d++){var c=e[d];c.classList.remove("in3_mediaoverlay_section_selection")}var g=document.getElementById(f);if(g!=null){g.classList.remove("in3_mediaoverlay_section_selection")}}function _SPt2PPt(d,c){px=d+jQuery(document).scrollLeft();py=c+jQuery(document).scrollTop();return{x:px,y:py}}function _PPt2SPt(d,c){sx=d-jQuery(document).scrollLeft();sy=c-jQuery(document).scrollTop();return{x:sx,y:sy}}function _pointInRect(c,e,d){if(c<d.left||c>d.right){return false}if(e<d.top||e>d.bottom){return false}return true}function _pointInRange(c,g,d){var f=d.getClientRects();if(f==null||f.length==0){return false}for(var e=0;e<f.length;e++){if(_pointInRect(c,g,f[e])){return true}}return false}function _rightBottomCornerCoord(c){var e=c.getClientRects();if(e==null||e.length==0){return null}var d=e[e.length-1];return{x:d.right,y:d.bottom}}function _findPositionFromPoint(k,c,l,h){var g=document.createRange();var f=h?-1:0;g.setStart(k,0);var e=1;for(;e<k.length+(h?0:0);e++){g.setEnd(k,e);if(_pointInRange(c,l,g)){g.setEnd(k,e+f);var d=_rightBottomCornerCoord(g);if(d==null){return{node:k,position:e+f,x:0,y:0}}else{return{node:k,position:e+f,x:d.x,y:d.y}}}}g.setEnd(k,e+f);var d=_rightBottomCornerCoord(g);if(d==null){return{node:k,position:e+f,x:0,y:0}}else{return{node:k,position:e+f,x:d.x,y:d.y}}}function getRangeFromPoint(n,k,l){var o=document.elementFromPoint(n,k);if(o==null||o.nodeName=="HTML"||o.node=="html"){return null}var e=null;var f=0;var c=null;var p=document.createRange();var d=o.firstChild;while(d!=null){if(d.nodeType==Node.TEXT_NODE){p.selectNode(d);var h=p.getClientRects();if(h!=null&&h.length!=0){for(var g=0;g<h.length;g++){if(_pointInRect(n,k,h[g])){return _findPositionFromPoint(d,n,k,l)}}}}d=d.nextSibling}return null}var g_range_start,g_range_end;function createSelectionUsingCaret(d,h){var g=document.caretRangeFromPoint(d,h);if(g==null){return null}if(g.startContainer.nodeType!=Node.TEXT_NODE){return null}g.expand("word");if(g.toString().length==0){return null}_debug("SELECT:Script.procStartSelection word: "+g.toString());window.getSelection().removeAllRanges();window.getSelection().addRange(g);g_range_start=document.createRange();g_range_start.setStart(g.startContainer,g.startOffset);g_range_start.setEnd(g.startContainer,g.startOffset);g_range_end=document.createRange();g_range_end.setStart(g.endContainer,g.endOffset);g_range_end.setEnd(g.endContainer,g.endOffset);var f=g.getClientRects();if(f==null||f.length==0){return null}var e=f[0];var c=f[f.length-1];return{begin_x:e.left,begin_y:e.bottom,end_x:c.right,end_y:c.bottom}}function updateSelectionUsingCaret(p,n,l,h){if(g_range_start==null||g_range_end==null){var e=window.getSelection();if(e==null||e.rangeCount==0||e.type=="None"){return null}var g=e.getRangeAt(0);g_range_start=document.createRange();g_range_start.setStart(g.startContainer,g.startOffset);g_range_start.setEnd(g.startContainer,g.startOffset);g_range_end=document.createRange();g_range_end.setStart(g.endContainer,g.endOffset);g_range_end.setEnd(g.endContainer,g.endOffset)}var u=document.caretRangeFromPoint(p,n);var k=document.caretRangeFromPoint(l,h);if(u==null||u.startContainer.nodeType!=Node.TEXT_NODE){u=g_range_start}if(k==null||k.startContainer.nodeType!=Node.TEXT_NODE){k=g_range_end}var c=u.compareBoundaryPoints(Range.START_TO_END,k);var d=false;if(c==1){var r=u;u=k;k=r}else{if(c==0){return null}}if(u.startContainer==g_range_start.startContainer&&u.startOffset==g_range_start.startOffset&&k.endContainer==g_range_end.endContainer&&k.endOffset==g_range_end.endOffset){return null}var o=document.createRange();o.setStart(u.startContainer,u.startOffset);o.setEnd(k.startContainer,k.startOffset);window.getSelection().removeAllRanges();window.getSelection().addRange(o);g_range_start=u;g_range_end=k;var f=o.getClientRects();if(f==null||f.length==0){_debug("SELECT:procSetSelection] No rects in range.");return null}var q,s;if(d){q=f[f.length-1];s=f[0]}else{q=f[0];s=f[f.length-1]}return{begin_x:q.left,begin_y:q.bottom,end_x:s.right,end_y:s.bottom}}function updateSelection(n,k,g,f){var e={x:n,y:k};var c={x:g,y:f};var h="sx:"+n+", sy:"+k+", ex:"+g+", ey:"+f;var o=getRangeFromPoint(e.x,e.y,false);var d=getRangeFromPoint(c.x,c.y,false);if(o==null||d==null){_debug("updateSelection: startRange "+(o==null?" is null, ":"is not null, ")+"endRange "+(d==null?" is null, ":"is not null, ")+"==>"+h);var l=document.createRange();if(o!=null){l.setStart(o.node,o.position);l.setEnd(o.node,o.position);window.getSelection().removeAllRanges();window.getSelection().addRange(l)}if(d!=null){l.setStart(d.node,d.position);l.setEnd(d.node,d.position);window.getSelection().removeAllRanges();window.getSelection().addRange(l)}return}var l=document.createRange();l.setStart(o.node,o.position);l.setEnd(d.node,d.position);window.getSelection().removeAllRanges();window.getSelection().addRange(l);e=_SPt2PPt(o.x,o.y);c=_SPt2PPt(d.x,d.y);return false}function getSelectionHandlePosition(){var f={sx:100,sy:100,ex:200,ey:100};var d=window.getSelection();if(d==null||d.type=="None"){return f}var c=d.getRangeAt(0);var h=c.getClientRects();if(h==null||h.length==0){return f}var g=h[0];var e=h[h.length-1];return{sx:g.left,sy:g.bottom,ex:e.right,ey:e.bottom}}var retObj={SOURCE:CALLBACK_HEADER,CMD_TYPE:"CMD_TYPE_ENGINE",CMD_CODE:"IN3_PAGE_LOAD",PARAM:{RESULT_CODE:0}};var serialJSON=JSON.stringify(retObj);if(g_DEFAULT_WEB_LOAD){if(IOS||PC){window.location="appcall?"+serialJSON}else{if(ANDROID){IN3JSBridge.IN3_JavascriptCallback(serialJSON)}else{parent.callback(serialJSON)}}};